{
  "comments": [
    {
      "key": {
        "uuid": "02a19ddd_ca9dd10b",
        "filename": "xyz/openbmc_project/State/Hypervisor.interface.yaml",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2021-01-14T15:40:18Z",
      "side": 1,
      "message": "Are these properties of a Redfish schema (I can\u0027t seem to find them) or are they the states of the Power hypervisor?  It would be nice if we could get someone with some expertise in other hypervisors to help determine if these are relatively standard / safe states or if they are IBM/PowerVM-specific.  Can you get someone from the PowerKVM team to weigh in?",
      "revId": "83199e58b0b28f8de6162c1406e5ce33be09c750",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc8510de_e0df4a2f",
        "filename": "xyz/openbmc_project/State/Hypervisor.interface.yaml",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2021-01-14T16:43:15Z",
      "side": 1,
      "message": "\u003e Are these properties of a Redfish schema (I can\u0027t seem to find them) or are they the states of the Power hypervisor? \n\nThese have a pretty good correlation with the BootProgress states we got in recently (see BootProgressTypes in https://redfish.dmtf.org/schemas/v1/ComputerSystem.v1_13_0.json)\n\nSystemHardwareInitializationComplete -\u003e Safe\nOSRunning -\u003e Runtime\n\nAnd a new one which I\u0027ve proposed and has been approved in https://github.com/DMTF/Redfish/issues/4336\n(name may change but currently it is this)\nSystemFirmwareSetupEntered -\u003e Setup\n\nFrom a \"how will we show this in Redfish\" perspective, we\u0027ll do something like we do with Systems/system in https://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/systems.hpp#L616 (getHostState()), we\u0027ll translate them over to what make sense.\n\n\u003e Can you get someone from the PowerKVM team to weigh in?\n\nSure, let me add Klaus. I think OPAL at least has the Safe/Runtime concept.",
      "parentUuid": "02a19ddd_ca9dd10b",
      "revId": "83199e58b0b28f8de6162c1406e5ce33be09c750",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d08c5fc3_94ef5f9e",
        "filename": "xyz/openbmc_project/State/Hypervisor.interface.yaml",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1000964
      },
      "writtenOn": "2021-01-20T16:24:16Z",
      "side": 1,
      "message": "\u003e \u003e Can you get someone from the PowerKVM team to weigh in?\n\u003e \n\u003e Sure, let me add Klaus. I think OPAL at least has the Safe/Runtime concept.\nOPAL is not really an hypervisor per-se, it just boots Linux who then acts as an hypervisor.\n\nI\u0027m not yet sufficiently acquainted with Redfish to review this properly, but I wanted to point out:\n\n1) In OPAL we do use \"IPMI override\" bootdev such as diag, safe, disk, network etc. When we are requested a \"safe\" boot we just don\u0027t probe the disks (this will usually stall boot unless you have prepared a static configuration on the nvram). Not sure if that maps cleanly to \u0027safe\u0027.\n\n2) Also regarding IPMI, we reset the boot counter sensor on successful boot\n\n3) I\u0027m not sure what I\u0027d do with this information.. i.e., in OPAL mode, would we monitor this? What would we do if this signals a transition to Runtime? I don\u0027t have an \"Idle\" state other than powered off, or auto-boot cancelled/failed perhaps\n\n4) Feels strange that we allow transitions from None to Runtime but apparently not the other way around.. Again, for OPAL/Linux, this is probably analogous with poweron/poweroff",
      "parentUuid": "dc8510de_e0df4a2f",
      "revId": "83199e58b0b28f8de6162c1406e5ce33be09c750",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "21cdffb3_fc562506",
        "filename": "xyz/openbmc_project/State/Hypervisor.interface.yaml",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2021-01-20T17:00:56Z",
      "side": 1,
      "message": "Thanks for the feedback Klaus.\n\n\u003e 3) I\u0027m not sure what I\u0027d do with this information.. i.e., in OPAL mode, would we monitor this? What would we do if this signals a transition to Runtime? I don\u0027t have an \"Idle\" state other than powered off, or auto-boot cancelled/failed perhaps\n\nI think this would be an indication to boot the default device and try to start the OS?\n\n\u003e 4) Feels strange that we allow transitions from None to Runtime but apparently not the other way around.. Again, for OPAL/Linux, this is probably analogous with poweron/poweroff\n\nYeah, I don\u0027t think there\u0027s anything to stop us from allowing you go from Runtime to Safe but there doesn\u0027t seem to be any use case for it now. Like you said, in most cases you just do the normal power off path of the system from Runtime.",
      "parentUuid": "d08c5fc3_94ef5f9e",
      "revId": "83199e58b0b28f8de6162c1406e5ce33be09c750",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0757d4f1_9df7ac3d",
        "filename": "xyz/openbmc_project/State/Hypervisor.interface.yaml",
        "patchSetId": 1
      },
      "lineNbr": 37,
      "author": {
        "id": 1000964
      },
      "writtenOn": "2021-01-22T17:55:31Z",
      "side": 1,
      "message": "\u003e Thanks for the feedback Klaus.\n\u003e \n\u003e \u003e 3) I\u0027m not sure what I\u0027d do with this information.. i.e., in OPAL mode, would we monitor this? What would we do if this signals a transition to Runtime? I don\u0027t have an \"Idle\" state other than powered off, or auto-boot cancelled/failed perhaps\n\u003e \n\u003e I think this would be an indication to boot the default device and try to start the OS?\n\nSo does this means that it is expected some hypervisor action whenever this field transitions? I\u0027m not sure we have any (easy) way of doing this from Skiroot / Petitboot, much less from Linux, but I\u0027ll point the Skiboot folks (Vasant, Mahesh) to this topic.\n\n\n\u003e \u003e 4) Feels strange that we allow transitions from None to Runtime but apparently not the other way around.. Again, for OPAL/Linux, this is probably analogous with poweron/poweroff\n\u003e \n\u003e Yeah, I don\u0027t think there\u0027s anything to stop us from allowing you go from Runtime to Safe but there doesn\u0027t seem to be any use case for it now. Like you said, in most cases you just do the normal power off path of the system from Runtime.\n\n\nExcluding the scenario where this transitions and some action is expected from the hypervisor (question above), I guess that for reporting this, the BMC could monitor our ipmi boot sensor and set this field to \u0027runtime\u0027 accordingly. Note that we don\u0027t have any redfish interfaces in OPAL, so that\u0027s probably the easiest / most straightforward path.",
      "parentUuid": "21cdffb3_fc562506",
      "revId": "83199e58b0b28f8de6162c1406e5ce33be09c750",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}